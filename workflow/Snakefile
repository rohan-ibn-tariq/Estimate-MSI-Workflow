# ============================================
# Estimate-MSI-Workflow - Main Entry Point
# ============================================


configfile: "config/config.yaml"


include: "rules/common.smk"
include: "rules/ref.smk"
include: "rules/microsatellites.smk"
include: "rules/reads.smk"
include: "rules/alignment.smk"
include: "rules/variant_calling.smk"
include: "rules/msi.smk"


rule all:
    input:
        # Reference genome and index files
        "resources/genome/genome.fasta",
        "resources/genome/genome.gtf",
        "resources/genome/genome.fasta.fai",
        multiext(
            "resources/genome/genome.fasta",
            ".amb",
            ".ann",
            ".bwt.2bit.64",
            ".pac",
            ".0123",
        ),
        # FASTQ files for all active samples
        expand(
            "resources/samples/{sample}_{read}.fastq.gz",
            sample=get_active_samples(),
            read=["R1", "R2"],
        ),
        # Alignment files (BAM + index)
        expand(
            "results/mapped/{sample}.bam",
            sample=get_active_samples(),
        ),
        expand(
            "results/mapped/{sample}.bam.bai",
            sample=get_active_samples(),
        ),
